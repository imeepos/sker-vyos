# 合规检查 (/security/compliance/checks)

## 页面概述

合规检查页面提供自动化的合规性检查功能，支持定时检查、手动触发、批量检查等多种检查模式，实时监控网络设备的合规状态。

## 核心功能

### 1. 检查任务管理
- 创建和配置检查任务
- 定时检查任务调度
- 检查任务状态监控

### 2. 自动化检查引擎
- 基于规则的自动检查
- 多协议检查支持（SSH、SNMP、API等）
- 分布式检查执行

### 3. 检查结果分析
- 实时检查结果展示
- 检查失败原因分析
- 历史趋势对比

### 4. 批量操作管理
- 批量设备检查
- 批量标准应用
- 检查结果批量处理

## 页面布局

### 顶部操作栏
```
┌─────────────────────────────────────────────────────────────────┐
│ [新建检查] [批量检查] [定时配置] [导入任务]  [搜索框] [状态▼] [时间▼] │
├─────────────────────────────────────────────────────────────────┤
│ 快速检查: [ISO27001] [GDPR] [PCI-DSS] [自定义]  [立即执行]         │
└─────────────────────────────────────────────────────────────────┘
```

### 主要统计区域
```
┌─────────────────────────────────────────────────────────────────┐
│ 检查状态概览                                                       │
├─────────────┬─────────────┬─────────────┬─────────────┬─────────────┤
│ 今日检查次数    │ 检查通过率     │ 执行中任务     │ 失败任务      │ 平均执行时间   │
│    156     │   92.3%    │     8      │     3     │   2.5分钟   │
└─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘
```

### 检查任务列表
```
┌─────────────────────────────────────────────────────────────────┐
│ 检查任务列表                        [刷新] [导出] [批量操作▼]         │
├────┬────────────┬────────┬─────────┬─────────┬─────────┬─────────┤
│ 选择 │ 任务名称      │ 合规标准  │ 目标设备   │ 执行状态   │ 最后执行  │ 操作     │
├────┼────────────┼────────┼─────────┼─────────┼─────────┼─────────┤
│ ☐  │ 每日安全检查   │ISO27001│ 全部设备  │ ✅ 已完成 │ 2小时前  │[查看][编辑]│
│ ☐  │ 防火墙规则检查 │自定义    │ 防火墙组  │ 🟡 执行中 │ 10分钟前 │[查看][停止]│
│ ☐  │ 访问控制检查   │GDPR    │ 路由器组  │ ❌ 失败   │ 1小时前  │[查看][重试]│
│ ☐  │ 数据加密检查   │PCI-DSS │ 核心设备  │ ⏸️ 暂停  │ 昨天     │[查看][恢复]│
└────┴────────────┴────────┴─────────┴─────────┴─────────┴─────────┘
```

### 检查详情面板
```
┌─────────────────────────────────────────────────────────────────┐
│ 检查任务详情 - 每日安全检查                              [关闭 ×]   │
├─────────────────────────────────────────────────────────────────┤
│ 基本信息:                                                      │
│   任务ID: CHK_001                   状态: ✅ 已完成            │
│   合规标准: ISO 27001              执行时间: 3分钟12秒         │
│   目标设备: 45台                   检查项目: 128个            │
│   开始时间: 2024-03-20 14:00:00                             │
├─────────────────────────────────────────────────────────────────┤
│ 执行进度:                                                      │
│   ████████████████████████████████████████████████ 100%      │
│   已完成: 45/45 设备    通过: 42台    失败: 3台               │
├─────────────────────────────────────────────────────────────────┤
│ 检查结果汇总:                                                  │
├──────────┬──────────┬──────────┬──────────┬──────────────────┤
│ 检查项分类  │ 总数      │ 通过      │ 失败      │ 通过率            │
├──────────┼──────────┼──────────┼──────────┼──────────────────┤
│ 访问控制   │    32    │    30    │     2    │     93.7%       │
│ 数据保护   │    28    │    26    │     2    │     92.8%       │
│ 网络安全   │    35    │    35    │     0    │     100%        │
│ 系统配置   │    33    │    31    │     2    │     93.9%       │
└──────────┴──────────┴──────────┴──────────┴──────────────────┘
├─────────────────────────────────────────────────────────────────┤
│ 失败项目详情:                                                  │
├────────────────────────┬─────────────┬───────────────────────┤
│ 设备                   │ 检查项       │ 失败原因               │
├────────────────────────┼─────────────┼───────────────────────┤
│ Router-01 (192.168.1.1) │ SSH密钥检查  │ 使用弱加密算法         │
│ Switch-03 (192.168.1.5) │ SNMP配置    │ 使用默认community字符串 │
│ FW-02 (192.168.1.10)   │ 日志配置    │ 未启用安全日志记录      │
└────────────────────────┴─────────────┴───────────────────────┘
├─────────────────────────────────────────────────────────────────┤
│          [查看详细日志] [导出报告] [创建修复任务] [重新检查]           │
└─────────────────────────────────────────────────────────────────┘
```

### 实时监控仪表板
```
┌───────────────────────────────┬─────────────────────────────────┐
│ 检查执行状态                    │ 检查结果趋势                      │
│ ┌───────────────────────────┐ │ ┌─────────────────────────────┐ │
│ │     正在执行: 3个任务       │ │ │        通过率趋势图           │ │
│ │     排队等待: 5个任务       │ │ │                             │ │
│ │     暂停任务: 1个任务       │ │ │                             │ │
│ └───────────────────────────┘ │ └─────────────────────────────┘ │
├───────────────────────────────┼─────────────────────────────────┤
│ 设备检查分布                    │ 风险等级分布                      │
│ ┌───────────────────────────┐ │ ┌─────────────────────────────┐ │
│ │      设备类型饼图           │ │ │       风险等级饼图            │ │
│ │                          │ │ │                             │ │
│ └───────────────────────────┘ │ └─────────────────────────────┘ │
└───────────────────────────────┴─────────────────────────────────┘
```

## API接口需求

### 获取检查任务列表
- **接口**: `GET /api/security/compliance/checks`
- **功能**: 获取所有检查任务列表
- **参数**: 分页、状态筛选、时间范围
- **返回**: 检查任务基本信息列表

### 创建检查任务
- **接口**: `POST /api/security/compliance/checks`
- **功能**: 创建新的检查任务
- **参数**: 任务配置、目标设备、检查标准
- **返回**: 创建的任务信息

### 执行检查任务
- **接口**: `POST /api/security/compliance/checks/{id}/execute`
- **功能**: 立即执行指定检查任务
- **参数**: 执行参数配置
- **返回**: 执行状态和任务ID

### 获取检查结果
- **接口**: `GET /api/security/compliance/checks/{id}/results`
- **功能**: 获取检查任务的详细结果
- **返回**: 完整的检查结果数据

### 批量检查接口
- **接口**: `POST /api/security/compliance/checks/batch`
- **功能**: 批量执行多个检查任务
- **参数**: 任务ID列表和执行配置

### 检查进度接口
- **接口**: `GET /api/security/compliance/checks/{id}/progress`
- **功能**: 获取检查任务的实时进度
- **返回**: 进度百分比和当前状态

## 检查引擎设计

### 检查规则定义
```typescript
interface CheckRule {
  id: string
  name: string
  description: string
  riskLevel: 'high' | 'medium' | 'low'
  checkType: 'config' | 'command' | 'api' | 'file'
  target: string
  condition: string
  expectedResult: any
  remediation?: string
}
```

### 检查任务配置
```typescript
interface CheckTask {
  id: string
  name: string
  description: string
  standardId: string
  targetDevices: string[]
  rules: CheckRule[]
  schedule?: ScheduleConfig
  notifications: NotificationConfig
  retryConfig: RetryConfig
}
```

### 检查结果结构
```typescript
interface CheckResult {
  taskId: string
  deviceId: string
  ruleId: string
  status: 'pass' | 'fail' | 'error' | 'skip'
  message: string
  details: any
  timestamp: string
  executionTime: number
}
```

## 组件设计

### 检查任务卡片
```vue
<CheckTaskCard
  :task="taskData"
  :status="taskStatus"
  @execute="handleExecute"
  @edit="handleEdit"
  @delete="handleDelete"
/>
```

### 检查进度组件
```vue
<CheckProgress
  :taskId="currentTaskId"
  :realtime="true"
  @complete="handleComplete"
  @error="handleError"
/>
```

### 结果分析组件
```vue
<ResultAnalysis
  :results="checkResults"
  :chartType="selectedChart"
  @export="handleExport"
  @drill-down="handleDrillDown"
/>
```

## 权限控制

### 查看权限
- 合规专员：完全查看
- 安全管理员：完全查看
- 运维工程师：基础查看

### 操作权限
- 创建任务：合规专员、安全管理员
- 执行检查：合规专员、安全管理员、运维工程师
- 修改任务：合规专员、安全管理员
- 删除任务：合规专员

### 结果权限
- 查看详细结果：合规专员、安全管理员
- 导出报告：合规专员、安全管理员、审计员
- 创建修复任务：安全管理员

## 性能优化

### 并发检查控制
- 限制同时执行的检查任务数量
- 根据设备类型分配检查资源
- 智能调度避免资源冲突

### 结果缓存策略
- 检查结果按时间分级缓存
- 相同配置的检查结果复用
- 增量更新检查状态

### 大规模设备支持
- 分批检查大量设备
- 检查进度实时更新
- 失败重试机制

## 告警和通知

### 检查失败告警
- 关键合规项失败立即告警
- 检查错误异常通知
- 趋势恶化预警

### 通知配置
- 邮件通知配置
- 企业微信/钉钉集成
- Webhook回调支持

## 集成能力

### 外部系统集成
- SIEM系统数据推送
- 工单系统联动
- 审计系统对接

### API开放能力
- 第三方检查引擎接入
- 自定义检查脚本支持
- 结果数据开放API